---
import type { CollectionEntry } from 'astro:content';

export interface Props {
	title?: string;
	entries: CollectionEntry<'projects' | 'articles' | 'work'>[];
	ariaDetails?: string;
}

const { title, entries, ariaDetails } = Astro.props;

const sortedEntries = entries.sort((a, b) => b.data.datePublished.getTime() - a.data.datePublished.getTime());

function allSameValue(keyName: string, arr: any[]): boolean {
	const values = arr.map((obj) => obj[keyName]);
	return new Set(values).size === 1;
}

const shouldLinkTitle = title && allSameValue('collection', sortedEntries);
const titleLink = shouldLinkTitle ? `/${sortedEntries[0].collection}` : null;
---

{
	sortedEntries.length > 0 && (
		<div class="post-list text-regular">
			{title && <h2 class="color-text-low-contrast">{titleLink ? <a href={titleLink}>{title}</a> : title}</h2>}

			<slot />

			<ul>
				{sortedEntries.map((entry) => (
					<li>
						<a
							class={`text-regular position--relative`}
							href={`/${entry.collection}/${entry.slug}`}
							aria-label={entry.data.description}>
							{entry.data.title}
							{entry.data.hoverImages && (
								<div class="hover-images">
									{entry.data.hoverImages.map((elem, i, array) => (
										<img
											src={`/images/hover-images/${elem}`}
											alt=""
											class={i === array.length - 1 ? 'main-image' : ''}
										/>
									))}
								</div>
							)}
						</a>
					</li>
				))}
			</ul>
		</div>
	)
}

<style lang="scss">
	@import '../styles/_vars.scss';

	.post-list {
		margin-block-start: 2rem;
		margin-block-end: 4rem;
		// line-height: 22px;
		// line-height: 1.6;
		// If font is SF Pro
	}

	ul {
		margin: 0;
		padding: 0;
		list-style: none;
	}

	img {
		position: absolute;
		top: 50%;
		right: 0;
		transform: translate(100%, 0%);
		transform-origin: left center;
		visibility: hidden;
		opacity: 0;
		z-index: 9999;
		transition: all 0.4s cubic-bezier(0.25, 1, 0.5, 1);
		border: none;
		padding: 0;
		overflow: clip;
		object-fit: cover;
	}

	.hover-images {
		position: absolute;
		top: 50%;
		right: 0;
		visibility: hidden;
		transition: all 0.4s cubic-bezier(0.25, 1, 0.5, 1);
		// background: rgba(255, 0, 0, 0.131);
		pointer-events: none;

		@media (pointer: coarse) {
			display: none;
		}

		// img:not(.main-image) {
		// 	&:nth-of-type(1) {
		// 		transform: translate(80%, -50%) scale(0.6);
		// 	}
		// 	&:nth-of-type(2) {
		// 		transform: translate(100%, -50%) scale(0.6);
		// 		transition-delay: 0.0125s;
		// 	}
		// 	&:nth-of-type(3) {
		// 		transform: translate(110%, -50%) scale(0.6);
		// 		transition-delay: 0.025s;
		// 	}
		// 	&:nth-of-type(4) {
		// 		transform: translate(120%, -50%) scale(0.6);
		// 		transition-delay: 0.025s;
		// 	}
		// }

		.main-image {
			transform: translate(130%, -50%) scale(0.8);
			filter: blur(12px);
			// transition-delay: 0.08s;
			outline: 2px solid rgba(0, 0, 0, 0.25);
			outline-offset: -2px;
			box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
			border-radius: 4px;
			aspect-ratio: 5/3;
			width: 380px;
		}
	}

	a {
		@media (pointer: fine) {
			&:hover {
				.hover-images {
					visibility: visible;

					img {
						visibility: visible;
						opacity: 1;
					}

					.main-image {
						filter: none;
					}

					// img:not(.main-image) {
					// 	&:nth-of-type(1) {
					// 		transform: translate(150%, -50%) scale(1);
					// 	}
					// 	&:nth-of-type(2) {
					// 		transform: translate(100%, -50%) scale(1);
					// 	}
					// 	&:nth-of-type(3) {
					// 		transform: translate(110%, -50%) scale(1);
					// 	}
					// 	&:nth-of-type(4) {
					// 		transform: translate(120%, -50%) scale(1);
					// 	}
					// }

					.main-image {
						transform: translate(140%, -50%) scale(1);
					}
				}
			}
		}
	}

	h2 {
		margin: 3px 0;

		a {
			text-decoration: revert;
		}
	}

	li,
	h2 {
		margin: 0.3rem 0;
	}

	span:hover {
	}

	a {
		display: inline-block;
		position: relative;
		text-decoration: none;

		&:hover {
			text-decoration: revert;
		}
	}

	@media (pointer: coarse) {
		// 	li,
		// 	h2 {
		// 		line-height: 1.6;
		// 	}

		a {
			padding-block: 0.125rem;
			// line-height: 1.6;
		}
	}

	@media (max-width: $screen-md) {
		.post-list {
			margin-bottom: 3rem;
		}
	}
</style>
